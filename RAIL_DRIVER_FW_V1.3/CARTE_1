//================================================//
// GESTION DES AUTOMATISMES DE LA CARTE 1         //
// TRAIN A CREMAILLERE						//
// AUTOFF => Pas d'action en mode manuel et si    // 
//           spécifié par une action (ACT),       //
//           désactivation de l'automatisme       //
//           correspondant		               //
//================================================//

// Connect Rail 0	Voie non connectée
// Connect Rail 1	Voie non connectée
// Connect Rail 2	Voie non connectée
// Connect Rail 3	Voie non connectée

// LPO 0		aiguillage E0 / (E0) H1 et E0 / G2
// LPO 1		non connecté (relié à un relai)
// LPO 2		Led bouton jaune
// LPO 3		Led mode manuel
// LPO 4		aiguillage I0 / J1 , K2
// LPO 5		non connecté (relié à un relai)

// GPIO input 0		aiguillage E0 / (E0) H1 et E0 / G2
// GPIO input 1		Bouton Jaune
// GPIO input 2		aiguillage E0 / (E0) H1 et E0 / G2
// GPIO input 3		Contact mode manuel

// Track Status	0	Afficheur 7 segments DIO
// Track Status	1	Afficheur 7 segments CLK
// Track Status	2	Potentiomètre inertie	
// Track Status	3	Potentiomètre vitesse

//////////////////////////////////////////////////////////////////////////
// MODE MANUEL 
//////////////////////////////////////////////////////////////////////////

// Détection commutation en mode manuel et activation du mode Manuel uniquement sur track 0
PROG 1 AUT M0 AUTON BOARD 1 GPIO 3 0 ACT MANUAL

// Détection commutation en mode manuel et éteint la LED orange
PROG 1 AUT M1 AUTON BOARD 1 GPIO 3 0 ACT LPO 2 0

// Allume led mode manuel
PROG 1 AUT M2 AUTON BOARD 1 GPIO 3 0 ACT LPO 3 1

// Remise à zéro du GPIO 3
PROG 1 AUT M3 AUTON BOARD 1 GPIO 3 0 ACT GPIO 3 0

// Arret complet en attente changement de consigne sur le TCO
PROG 1 AUT M4 AUTON BOARD 1 GPIO 3 0 ACT TRACK 4 SPEED 0 FORW INERTIA 0

//////////////////////////////////////////////////////////////////////////
// MODE AUTOMATIQUE 
//////////////////////////////////////////////////////////////////////////

// Détection commutation en mode automatique et activation du mode automatique
PROG 1 AUT A1 AUTON BOARD 1 GPIO 3 1 ACT AUTOMATIC

// Détection commutation en mode automatique et Eteint led mode manuel
PROG 1 AUT A2 AUTON BOARD 1 GPIO 3 1 ACT LPO 3 0

// Positionne correctement les aiguillages du haut
PROG 1 AUT A3 AUTOFF BOARD 1 GPIO 1 1 ACT LPO 4 0

// Allume la LED jaune du bouton sur appui bouton
PROG 1 AUT A4 AUTOFF BOARD 1 GPIO 1 1 ACT LPO 2 1

//Désactive arret du train en gare centrale 
PROG 1 AUT A5 AUTOFF BOARD 1 GPIO 1 1 ACT AUTOFF DA

// Demarre le train (qui doit être quelque part sur la voie) voie A, B, C et D
PROG 1 AUT A6 AUTOFF BOARD 1 GPIO 1 1 ACT TRACK 4 SPEED 8 FORW INERTIA 20

// Réinitialise GPIO 1 sur relachement bouton
PROG 1 AUT A7 AUTOFF BOARD 1 GPIO 1 0 ACT GPIO 1 0

// Détection du train sur la voie K, arret des voies I, J, K et L
PROG 1 AUT A8 AUTOFF BOARD 1 TRACK 2 STA ONTRACK ACT TRACK 4 SPEED 0 FORW INERTIA 20

// Arme TIMER 1 pour attente en gare du haut pendant 10 unités (A modifier) 
PROG 1 AUT A9 AUTOFF BOARD 1 TRACK 2 STA ONTRACK ACT TIMER 1 10 

// Désactive A8, A9
PROG 1 AUT AA AUTOFF BOARD 1 TRACK 2 STA ONTRACK ACT AUTOFF A8
PROG 1 AUT AB AUTOFF BOARD 1 TRACK 2 STA ONTRACK ACT AUTOFF A9

//active arret du train en gare centrale 
PROG 1 AUT AC AUTOFF BOARD 1 TRACK 2 STA ONTRACK ACT AUTON DA

// Démarrage séquence premier décrochage locomotive (gare du haut)

// Démarrage lent pour décrochage wagon 
PROG 1 AUT D1 AUTOFF BOARD 1 TIMER 1 ACT TRACK 4 SPEED 4 FORW INERTIA 80

// Arme TIMER 4 pour retour arrière locomotive
PROG 1 AUT D2 AUTOFF BOARD 1 TIMER 1 ACT TIMER 4 2

// retour arrière locomotive sur déclenchement TIMER 4
PROG 1 AUT D3 AUTOFF BOARD 1 TIMER 4 ACT TRACK 4 SPEED 5 BACK INERTIA 10

// changement aiguillage sur déclenchement TIMER 4
PROG 1 AUT D4 AUTOFF BOARD 1 TIMER 4 ACT LPO 4 1

// Arme TIMER 5 pour retour avant locomotive 
PROG 1 AUT D5 AUTOFF BOARD 1 TIMER 4 ACT TIMER 5 2

//Retour avant de la locomotive au déclenchement TIMER 5
PROG 1 AUT D6 AUTOFF BOARD 1 TIMER 5 ACT TRACK 4 SPEED 4 FORW INERTIA 20

// changement aiguillage sur déclenchement TIMER 5
PROG 1 AUT D7 AUTOFF BOARD 1 TIMER 5 ACT LPO 4 0

// Arme TIMER 6 pour retour final locomotive
PROG 1 AUT D8 AUTOFF BOARD 1 TIMER 5 ACT TIMER 6 2

//retour du train vers la gare centrale (voie I, J, K et L)
PROG 1 AUT D9 AUTOFF BOARD 1 TIMER 6 ACT TRACK 4 SPEED 5 BACK INERTIA 15

// Arret du train lors de l'arrivée en gare centrale (voie A, B, C et D)
PROG 1 AUT DA AUTOFF BOARD 1 TRACK 0 STA ONTRACK ACT TRACK 4 SPEED 0 BACK INERTIA 100

// Réactive A8, A9
PROG 1 AUT DB AUTOFF BOARD 1 TRACK 0 STA ONTRACK ACT AUTON A8
PROG 1 AUT DC AUTOFF BOARD 1 TRACK 0 STA ONTRACK ACT AUTON A9

// Démarrage séquence deuxième décrochage locomotive (partie cachée)

///////////////////////////////////////////////////
// Commande manuel aiguillage E0 / (E0) H1 et E0 / G2

PROG 1 AUT C1 AUTON BOARD 1 GPIO 2 1 ACT LPO 0 1
PROG 1 AUT C2 AUTON BOARD 1 GPIO 0 1 ACT LPO 0 0

// Commande manuel aiguillage I0 / J1 , K2
PROG 1 AUT C3 AUTON BOARD 3 GPIO 0 1 ACT LPO 4 1
PROG 1 AUT C4 AUTON BOARD 3 GPIO 1 1 ACT LPO 4 0

PROG 1 AUT C5 AUTON BOARD 1 GPIO 0 0 ACT GPIO 0 0
PROG 1 AUT C6 AUTON BOARD 1 GPIO 2 0 ACT GPIO 2 0
